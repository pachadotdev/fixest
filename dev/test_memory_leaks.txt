==17149== Memcheck, a memory error detector
==17149== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
==17149== Using Valgrind-3.18.1 and LibVEX; rerun with -h for copyright info
==17149== Command: /usr/lib/R/bin/exec/R --vanilla -f dev/test_memory_leaks.r
==17149== 

R version 4.3.2 (2023-10-31) -- "Eye Holes"
Copyright (C) 2023 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> if (!require("devtools")) install.packages("devtools")
Loading required package: devtools
Loading required package: usethis
> devtools::load_all()
â„¹ Loading fixest2
> 
> data(airquality)
> 
> # On multiple estimations: see the dedicated vignette
> est <- feols(
+   Ozone ~ Solar.R,
+   airquality
+ )
NOTE: 42 observations removed because of NA values (LHS: 37, RHS: 7).
> est <- feols(Ozone ~ Solar.R,
+   airquality,
+   cluster = ~Day
+ )
NOTE: 42 observations removed because of NA values (LHS: 37, RHS: 7).
> 
> est <- feols(Ozone ~ Solar.R + sw0(Wind + Temp) | csw(Month, Day),
+   airquality,
+   cluster = ~Day
+ )
NOTE: 42 observations removed because of NA values (LHS: 37, RHS: 7).
      |-> this msg only concerns the variables common to all estimations
> 
> # Setting a dictionary
> setFixest_dict(c(
+   Ozone = "Ozone (ppb)", Solar.R = "Solar Radiation (Langleys)",
+   Wind = "Wind Speed (mph)", Temp = "Temperature"
+ ))
> 
> library(pander)
> 
> setFixest_notes(FALSE)
> setFixest_etable(digits = 3)
> 
> etable(est)
                                      est.1            est.2           est.3
Dependent Var.:                 Ozone (ppb)      Ozone (ppb)     Ozone (ppb)
                                                                            
Solar Radiation (Langleys) 0.115*** (0.023)   0.052* (0.020) 0.108** (0.033)
Wind Speed (mph)                            -3.11*** (0.799)                
Temperature                                  1.88*** (0.367)                
Fixed-Effects:             ---------------- ---------------- ---------------
Month                                   Yes              Yes             Yes
Day                                      No               No             Yes
__________________________ ________________ ________________ _______________
S.E.: Clustered                     by: Day          by: Day         by: Day
Observations                            111              111             111
R2                                  0.31974          0.63686         0.58018
Within R2                           0.12245          0.53154         0.12074

                                      est.4
Dependent Var.:                 Ozone (ppb)
                                           
Solar Radiation (Langleys)   0.051* (0.024)
Wind Speed (mph)           -3.29*** (0.778)
Temperature                 2.05*** (0.242)
Fixed-Effects:             ----------------
Month                                   Yes
Day                                     Yes
__________________________ ________________
S.E.: Clustered                     by: Day
Observations                            111
R2                                  0.81604
Within R2                           0.61471
---
Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> 
> etable(est, style.df = style.df(
+   depvar.title = "", fixef.title = "",
+   fixef.suffix = " fixed effect", yesNo = "yes"
+ ))
                                      est.1            est.2           est.3
                                Ozone (ppb)      Ozone (ppb)     Ozone (ppb)
                                                                            
Solar Radiation (Langleys) 0.115*** (0.023)   0.052* (0.020) 0.108** (0.033)
Wind Speed (mph)                            -3.11*** (0.799)                
Temperature                                  1.88*** (0.367)                
Month fixed effect                      yes              yes             yes
Day fixed effect                                                         yes
__________________________ ________________ ________________ _______________
S.E.: Clustered                     by: Day          by: Day         by: Day
Observations                            111              111             111
R2                                  0.31974          0.63686         0.58018
Within R2                           0.12245          0.53154         0.12074

                                      est.4
                                Ozone (ppb)
                                           
Solar Radiation (Langleys)   0.051* (0.024)
Wind Speed (mph)           -3.29*** (0.778)
Temperature                 2.05*** (0.242)
Month fixed effect                      yes
Day fixed effect                        yes
__________________________ ________________
S.E.: Clustered                     by: Day
Observations                            111
R2                                  0.81604
Within R2                           0.61471
---
Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> 
> # # NOTE:
> # # The evaluation of the code of this section requires the
> # #   package 'pander' which is not installed.
> # # The code output is not reported.
> # etable(est, postprocess.df = pandoc.table.return, style = "rmarkdown")
> 
> my_style <- style.df(
+   depvar.title = "", fixef.title = "",
+   fixef.suffix = " fixed effect", yesNo = "yes"
+ )
> setFixest_etable(style.df = my_style, postprocess.df = pandoc.table.return)
> 
> etable(est[rhs = 2], style = "rmarkdown", caption = "New default values")


|           &nbsp;           |  est[rhs = 2].1  |  est[rhs = 2].2  |
|:--------------------------:|:----------------:|:----------------:|
|                            |   Ozone (ppb)    |   Ozone (ppb)    |
|                            |                  |                  |
| Solar Radiation (Langleys) |  0.052* (0.020)  |  0.051* (0.024)  |
|      Wind Speed (mph)      | -3.11*** (0.799) | -3.29*** (0.778) |
|        Temperature         | 1.88*** (0.367)  | 2.05*** (0.242)  |
|     Month fixed effect     |       yes        |       yes        |
|      Day fixed effect      |                  |       yes        |
| __________________________ | ________________ | ________________ |
|      S.E.: Clustered       |     by: Day      |     by: Day      |
|        Observations        |       111        |       111        |
|             R2             |     0.63686      |     0.81604      |
|         Within R2          |     0.53154      |     0.61471      |

Table: New default values

> 
> est_slopes <- feols(Ozone ~ Solar.R + Wind | Day + Month[Temp], airquality)
> 
> etable(est, est_slopes, tex = TRUE)
\begingroup
\centering
\begin{tabular}{lccccc}
   \tabularnewline \midrule \midrule
   Dependent Variable: & \multicolumn{5}{c}{Ozone (ppb)}\\
   Model:                     & (1)           & (2)           & (3)           & (4)           & (5)\\  
   \midrule
   \emph{Variables}\\
   Solar Radiation (Langleys) & 0.115$^{***}$ & 0.052$^{**}$  & 0.108$^{***}$ & 0.051$^{**}$  & 0.056$^{**}$\\   
                              & (0.023)       & (0.020)       & (0.033)       & (0.024)       & (0.023)\\   
   Wind Speed (mph)           &               & -3.11$^{***}$ &               & -3.29$^{***}$ & -3.05$^{***}$\\   
                              &               & (0.799)       &               & (0.778)       & (0.822)\\   
   Temperature                &               & 1.88$^{***}$  &               & 2.05$^{***}$  &   \\   
                              &               & (0.367)       &               & (0.242)       &   \\   
   \midrule
   \emph{Fixed-effects}\\
   Month                      & Yes           & Yes           & Yes           & Yes           & Yes\\  
   Day                        &               &               & Yes           & Yes           & Yes\\  
   \midrule
   \emph{Varying Slopes}\\
   Temperature (Month)        &               &               &               &               & Yes\\  
   \midrule
   \emph{Fit statistics}\\
   Observations               & 111           & 111           & 111           & 111           & 111\\  
   R$^2$                      & 0.31974       & 0.63686       & 0.58018       & 0.81604       & 0.82896\\  
   Within R$^2$               & 0.12245       & 0.53154       & 0.12074       & 0.61471       & 0.25843\\  
   \midrule \midrule
   \multicolumn{6}{l}{\emph{Clustered (Day) standard-errors in parentheses}}\\
   \multicolumn{6}{l}{\emph{Signif. Codes: ***: 0.01, **: 0.05, *: 0.1}}\\
\end{tabular}
\par\endgroup
> 
> etable(est, est_slopes,
+   style.tex = style.tex("aer"),
+   signif.code = NA, fitstat = ~ r2 + n, tex = TRUE
+ )
\begingroup
\centering
\begin{tabular}{lccccc}
   \toprule
    & \multicolumn{5}{c}{Ozone (ppb)}\\
                                & (1)           & (2)           & (3)           & (4)           & (5)\\  
   \midrule 
   Solar Radiation (Langleys)   & 0.115         & 0.052         & 0.108         & 0.051         & 0.056\\   
                                & (0.023)       & (0.020)       & (0.033)       & (0.024)       & (0.023)\\   
   Wind Speed (mph)             &               & -3.11         &               & -3.29         & -3.05\\   
                                &               & (0.799)       &               & (0.778)       & (0.822)\\   
   Temperature                  &               & 1.88          &               & 2.05          &   \\   
                                &               & (0.367)       &               & (0.242)       &   \\   
    \\
   R$^2$                        & 0.31974       & 0.63686       & 0.58018       & 0.81604       & 0.82896\\  
   Observations                 & 111           & 111           & 111           & 111           & 111\\  
    \\
   Month fixed effects          & $\checkmark$  & $\checkmark$  & $\checkmark$  & $\checkmark$  & $\checkmark$\\   
   Day fixed effects            &               &               & $\checkmark$  & $\checkmark$  & $\checkmark$\\   
   Temperature $\times $ Month  &               &               &               &               & $\checkmark$\\   
   \bottomrule
\end{tabular}
\par\endgroup
> 
> set_rules <- function(x, heavy, light) {
+   # x: the character vector returned by etable
+ 
+   tex2add <- ""
+   if (!missing(heavy)) {
+     tex2add <- paste0("\\setlength\\heavyrulewidth{", heavy, "}\n")
+   }
+   if (!missing(light)) {
+     tex2add <- paste0(tex2add, "\\setlength\\lightrulewidth{", light, "}\n")
+   }
+ 
+   if (nchar(tex2add) > 0) {
+     x[x == "%start:tab\n"] <- tex2add
+   }
+ 
+   x
+ }
> 
> etable(est, est_slopes, postprocess.tex = set_rules, heavy = "0.14em", tex = TRUE)
\begingroup
\centering
\setlength\heavyrulewidth{0.14em}
\begin{tabular}{lccccc}
   \tabularnewline \midrule \midrule
   Dependent Variable: & \multicolumn{5}{c}{Ozone (ppb)}\\
   Model:                     & (1)           & (2)           & (3)           & (4)           & (5)\\  
   \midrule
   \emph{Variables}\\
   Solar Radiation (Langleys) & 0.115$^{***}$ & 0.052$^{**}$  & 0.108$^{***}$ & 0.051$^{**}$  & 0.056$^{**}$\\   
                              & (0.023)       & (0.020)       & (0.033)       & (0.024)       & (0.023)\\   
   Wind Speed (mph)           &               & -3.11$^{***}$ &               & -3.29$^{***}$ & -3.05$^{***}$\\   
                              &               & (0.799)       &               & (0.778)       & (0.822)\\   
   Temperature                &               & 1.88$^{***}$  &               & 2.05$^{***}$  &   \\   
                              &               & (0.367)       &               & (0.242)       &   \\   
   \midrule
   \emph{Fixed-effects}\\
   Month                      & Yes           & Yes           & Yes           & Yes           & Yes\\  
   Day                        &               &               & Yes           & Yes           & Yes\\  
   \midrule
   \emph{Varying Slopes}\\
   Temperature (Month)        &               &               &               &               & Yes\\  
   \midrule
   \emph{Fit statistics}\\
   Observations               & 111           & 111           & 111           & 111           & 111\\  
   R$^2$                      & 0.31974       & 0.63686       & 0.58018       & 0.81604       & 0.82896\\  
   Within R$^2$               & 0.12245       & 0.53154       & 0.12074       & 0.61471       & 0.25843\\  
   \midrule \midrule
   \multicolumn{6}{l}{\emph{Clustered (Day) standard-errors in parentheses}}\\
   \multicolumn{6}{l}{\emph{Signif. Codes: ***: 0.01, **: 0.05, *: 0.1}}\\
\end{tabular}
\par\endgroup
> 
> setFixest_etable(
+   style.tex = style.tex("aer", signif.code = NA), postprocess.tex = set_rules,
+   fitstat = ~ r2 + n
+ )
> 
> etable(est, heavy = "0.14em", tex = TRUE)
\begingroup
\centering
\setlength\heavyrulewidth{0.14em}
\begin{tabular}{lcccc}
   \toprule
    & \multicolumn{4}{c}{Ozone (ppb)}\\
                              & (1)           & (2)           & (3)           & (4)\\  
   \midrule 
   Solar Radiation (Langleys) & 0.115         & 0.052         & 0.108         & 0.051\\   
                              & (0.023)       & (0.020)       & (0.033)       & (0.024)\\   
   Wind Speed (mph)           &               & -3.11         &               & -3.29\\   
                              &               & (0.799)       &               & (0.778)\\   
   Temperature                &               & 1.88          &               & 2.05\\   
                              &               & (0.367)       &               & (0.242)\\   
    \\
   R$^2$                      & 0.31974       & 0.63686       & 0.58018       & 0.81604\\  
   Observations               & 111           & 111           & 111           & 111\\  
    \\
   Month fixed effects        & $\checkmark$  & $\checkmark$  & $\checkmark$  & $\checkmark$\\   
   Day fixed effects          &               &               & $\checkmark$  & $\checkmark$\\   
   \bottomrule
\end{tabular}
\par\endgroup
> 
> fitstat_register(
+   type = "p_s", alias = "pvalue (standard)",
+   fun = function(x) pvalue(x, vcov = "iid")["Solar.R"]
+ )
> 
> fitstat_register(
+   type = "p_h", alias = "pvalue (Heterosk.)",
+   fun = function(x) pvalue(x, vcov = "hetero")["Solar.R"]
+ )
> 
> fitstat_register(
+   type = "p_day", alias = "pvalue (Day)",
+   fun = function(x) pvalue(x, vcov = ~Day)["Solar.R"]
+ )
> 
> fitstat_register(
+   type = "p_month", alias = "pvalue (Month)",
+   fun = function(x) pvalue(x, vcov = ~Month)["Solar.R"]
+ )
> 
> # We first reset the default values set in the previous sections
> setFixest_etable(reset = TRUE)
> # Now we display the results with the new fit statistics
> etable(est, fitstat = ~ . + p_s + p_h + p_day + p_month)
                                        est.1              est.2
Dependent Var.:                   Ozone (ppb)        Ozone (ppb)
                                                                
Solar Radiation (Langleys) 0.1148*** (0.0234)   0.0522* (0.0202)
Wind Speed (mph)                              -3.109*** (0.7986)
Temperature                                    1.875*** (0.3671)
Fixed-Effects:             ------------------ ------------------
Month                                     Yes                Yes
Day                                        No                 No
__________________________ __________________ __________________
S.E.: Clustered                       by: Day            by: Day
Observations                              111                111
R2                                    0.31974            0.63686
Within R2                             0.12245            0.53154
pvalue (standard)                     0.00022            0.02957
pvalue (Heterosk.)                    6.64e-6            0.02268
pvalue (Day)                             3e-5            0.01468
pvalue (Month)                        0.06066            0.26992

                                       est.3              est.4
Dependent Var.:                  Ozone (ppb)        Ozone (ppb)
                                                               
Solar Radiation (Langleys) 0.1078** (0.0329)   0.0509* (0.0236)
Wind Speed (mph)                             -3.289*** (0.7777)
Temperature                                   2.052*** (0.2415)
Fixed-Effects:             ----------------- ------------------
Month                                    Yes                Yes
Day                                      Yes                Yes
__________________________ _________________ __________________
S.E.: Clustered                      by: Day            by: Day
Observations                             111                111
R2                                   0.58018            0.81604
Within R2                            0.12074            0.61471
pvalue (standard)                    0.00196            0.03720
pvalue (Heterosk.)                   0.00103            0.02815
pvalue (Day)                         0.00263            0.03881
pvalue (Month)                       0.02676            0.29967
---
Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> 
> summary(.l(est, est_slopes), cluster = ~Month)
[[1]]
OLS estimation, Dep. Var.: Ozone
Observations: 111
Fixed-effects: Month: 5
Standard-errors: Clustered (Month) 
        Estimate Std. Error t value Pr(>|t|)    
Solar.R 0.114843   0.044336  2.5903 0.060665 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 27.3     Adj. R2: 0.287347
             Within R2: 0.122452

[[2]]
OLS estimation, Dep. Var.: Ozone
Observations: 111
Fixed-effects: Month: 5
Standard-errors: Clustered (Month) 
         Estimate Std. Error  t value   Pr(>|t|)    
Solar.R  0.052220   0.040816  1.27942 0.26992204    
Wind    -3.108720   1.306402 -2.37960 0.07602194 .  
Temp     1.875111   0.181649 10.32273 0.00049691 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 20.0     Adj. R2: 0.612182
             Within R2: 0.531544

[[3]]
OLS estimation, Dep. Var.: Ozone
Observations: 111
Fixed-effects: Month: 5,  Day: 31
Standard-errors: Clustered (Month) 
        Estimate Std. Error t value Pr(>|t|)    
Solar.R 0.107799   0.031512 3.42093 0.026757 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 21.5     Adj. R2: 0.384269
             Within R2: 0.120745

[[4]]
OLS estimation, Dep. Var.: Ozone
Observations: 111
Fixed-effects: Month: 5,  Day: 31
Standard-errors: Clustered (Month) 
         Estimate Std. Error  t value  Pr(>|t|)    
Solar.R  0.050940   0.042788  1.19051 0.2996692    
Wind    -3.289443   1.050663 -3.13083 0.0351572 *  
Temp     2.051666   0.239028  8.58337 0.0010121 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 14.2     Adj. R2: 0.722794
             Within R2: 0.61471 

[[5]]
OLS estimation, Dep. Var.: Ozone
Observations: 111
Fixed-effects: Day: 31,  Month: 5
Varying slopes: Temp (Month): 5
Standard-errors: Clustered (Month) 
         Estimate Std. Error  t value Pr(>|t|)    
Solar.R  0.056140   0.044377  1.26506 0.274527    
Wind    -3.048357   1.150783 -2.64894 0.057045 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 13.7     Adj. R2: 0.727334
             Within R2: 0.258425

> 
==17149== 
==17149== HEAP SUMMARY:
==17149==     in use at exit: 197,729,072 bytes in 32,944 blocks
==17149==   total heap usage: 604,451 allocs, 571,507 frees, 1,113,377,480 bytes allocated
==17149== 
==17149== LEAK SUMMARY:
==17149==    definitely lost: 0 bytes in 0 blocks
==17149==    indirectly lost: 0 bytes in 0 blocks
==17149==      possibly lost: 1,008 bytes in 3 blocks
==17149==    still reachable: 197,728,064 bytes in 32,941 blocks
==17149==                       of which reachable via heuristic:
==17149==                         newarray           : 4,264 bytes in 1 blocks
==17149==         suppressed: 0 bytes in 0 blocks
==17149== Rerun with --leak-check=full to see details of leaked memory
==17149== 
==17149== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
