if (!require("devtools")) { install.packages("devtools") }

devtools::load_all()

input <- readRDS("dev/input.rds")

# explicitly convert to the right data types

Q <- as.integer(input$Q)

N <- as.integer(input$N)

S <- as.double(input$S)

dumMat <- input$dumMat
storage.mode(dumMat) <- "integer"

nbCluster <- as.integer(input$nbCluster)

orderCluster <- input$orderCluster
storage.mode(orderCluster) <- "integer"

# check the data types
print(paste("Q", class(Q)))
print(paste("N", class(N)))
print(paste("S", class(S)))
print(paste("dumMat", class(dumMat)))
print(paste("nbCluster", class(nbCluster)))
print(paste("orderCluster", class(orderCluster)))

# check dimensions
print(paste("Q", length(Q)))
print(paste("N", length(N)))
print(paste("S", length(S)))
print(paste("dumMat", paste("rows", dim(dumMat)[1], "cols", dim(dumMat)[2])))
print(paste("nbCluster", length(nbCluster)))
print(paste("orderCluster", paste("rows", dim(orderCluster)[1], "cols", dim(orderCluster)[2])))

fixef_values <- cpp_get_fe_gnl(Q, N, S, dumMat, nbCluster, orderCluster)

# # run 1 time

# [[1]]
#  [1] 22.50802 23.56068 24.70769 24.96690 21.64615 24.67546 23.75072 23.08105
#  [9] 23.19499 24.32840 20.23023 24.43460 22.44476 23.25143 23.44093

# [[2]]
#  [1] 2.435895 2.695877 4.322875 4.043327 2.817644 4.168774 4.064073 3.143755
#  [9] 2.588554 4.217882 0.000000 3.230585 2.552345 3.570083 2.451105

# [[3]]
#  [1]  0.00000000  1.41436908  0.65624654  1.44923309 -1.52073341  0.24061915
#  [7]  0.90627290  0.99818202 -0.43707295  0.38013238 -0.69887170 -0.09549963
# [13] -1.94791717 -4.43050543  0.69615767  0.33033306  0.07365566  0.49554792
# [19]  0.94009439  0.80754214

# [[4]]
#  [1] 0.000000000 0.069122284 0.005225473 0.073308208 0.163013386 0.192605170
#  [7] 0.230629376 0.242605404 0.282800683 0.310325692

# [[5]]
# [1] 0 1 1 1

# # 2 times

# [[1]]
#  [1] 22.50802 23.56068 24.70769 24.96690 21.64615 24.67546 23.75072 23.08105
#  [9] 23.19499 24.32840 20.23023 24.43460 22.44476 23.25143 23.44093

# [[2]]
#  [1] 2.435895 2.695877 4.322875 4.043327 2.817644 4.168774 4.064073 3.143755
#  [9] 2.588554 4.217882 0.000000 3.230585 2.552345 3.570083 2.451105

# [[3]]
#  [1]  0.00000000  1.41436908  0.65624654  1.44923309 -1.52073341  0.24061915
#  [7]  0.90627290  0.99818202 -0.43707295  0.38013238 -0.69887170 -0.09549963
# [13] -1.94791717 -4.43050543  0.69615767  0.33033306  0.07365566  0.49554792
# [19]  0.94009439  0.80754214

# [[4]]
#  [1] 0.000000000 0.069122284 0.005225473 0.073308208 0.163013386 0.192605170
#  [7] 0.230629376 0.242605404 0.282800683 0.310325692

# [[5]]
# [1] 0 1 1 1

# # 3 times

# [[1]]
#  [1] -6.528034e+174   2.356068e+01 -9.701583e+189  7.124978e+247 -1.239083e+243
#  [6] -2.649869e+180 -1.925268e+161 -1.425001e+248 -9.701583e+189 -1.195772e+195
# [11] -2.268224e+161 -1.239083e+243  7.124978e+247 -1.239083e+243   2.344093e+01

# [[2]]
#  [1]   2.714358e+01  9.701583e+189 -5.264835e+170 -4.909091e+252  -5.954704e+05
#  [6] -7.124978e+247  1.239083e+243  1.195772e+195 -2.642801e+180 -4.818072e+233
# [11]   0.000000e+00   3.230585e+00 -5.824823e+252 -3.655883e+233  1.239083e+243

# [[3]]
#  [1]   0.000000e+00   1.414369e+00 -7.499123e+247   1.449233e+00 -8.887852e+252
#  [6] -8.828937e+199 -1.344998e+161 -1.977658e+161 -1.555885e+161   3.801324e-01
# [11]  -6.988717e-01  -9.549963e-02  -1.947917e+00 -1.668282e+243 -4.145525e+193
# [16] -3.033326e+180 -3.984507e+252   4.955479e-01   9.400944e-01   8.075421e-01

# [[4]]
#  [1]   0.000000e+00 -4.929770e+204 -3.970624e+246 -6.058692e+241 -3.429098e+169
#  [6]   1.926052e-01   2.306294e-01 -4.219358e+262   2.828007e-01   3.103257e-01

# [[5]]
# [1] 0 1 1 1
